<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Cache Plugin</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Cache Plugin
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>
                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#usage"><strong>2</strong><span>Usage</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#cacheTags"><strong>3</strong><span>Caching Tags</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#grailsCacheAdminService"><strong>4</strong><span>The Cache Admin Service</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#implementation"><strong>5</strong><span>Implementation Details</span></a></div>
                        
                    </div>
                </div>
            </li>
            <li>
                <a href="../api/index.html" class="button">API Reference</a>
            </li>
        </ul>

    </div>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                <div class="project">
                    <h1>Cache Plugin</h1>
                    <p></p>
                    <p>Provides AST transformations for caching method calls</p>
                    <p><strong>Version:</strong> 5.0.1-SNAPSHOT</p>

                </div>
                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#changeLog"><strong>1.1</strong><span>Change Log</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#usage"><strong>2</strong><span>Usage</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#dsl"><strong>2.1</strong><span>Configuration</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#annotations"><strong>2.2</strong><span>Cache Annotations</span></a></div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#unittests"><strong>2.2.1</strong><span>Unit Testing</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#cacheManager"><strong>2.3</strong><span>The CacheManager</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#cacheTags"><strong>3</strong><span>Caching Tags</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#grailsCacheAdminService"><strong>4</strong><span>The Cache Admin Service</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clearingCaches"><strong>4.1</strong><span>Clearing Caches</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#implementation"><strong>5</strong><span>Implementation Details</span></a></div>
                    
                    <div style="clear:both" ></div>
                </div>
                
                

<h1 id="introduction">1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Grails Cache plugin provides powerful and easy to use caching functionality to Grails applications and plugins.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Cache version 4.0.0 and higher requires GORM 6.1.x or higher
</td>
</tr>
</table>
</div>


<h2 id="changeLog">1.1 Change Log</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/introduction/changeLog.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="changeLog">Change log</h3>
<div class="paragraph">
<p>For recent versions please check the release notes <a href="https://github.com/grails-plugins/grails-cache/releases">here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_version_4_0_0">Version 4.0.0</h3>
<div class="ulist">
<ul>
<li>
<p>AST based solution.</p>
</li>
<li>
<p>Closures instead of SpEL</p>
</li>
<li>
<p>Controller caching is no longer supported.</p>
</li>
<li>
<p>CacheEvict beforeInvocation is no longer supported. The eviction will always occur before the method.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_version_1_1_7_june_24_2014">Version 1.1.7 - June 24, 2014</h3>
<div class="paragraph">
<p>Requires Grails 2.3 or later</p>
</div>
</div>
<div class="sect2">
<h3 id="_version_1_1_6_may_9_2014">Version 1.1.6 - May 9, 2014</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_5_april_25_2014">Version 1.1.5 - April 25, 2014</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_4_april_25_2014">Version 1.1.4 - April 25, 2014</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_3_april_24_2014">Version 1.1.3 - April 24, 2014</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_2_april_23_2014">Version 1.1.2 - April 23, 2014</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_1_july_3_2013">Version 1.1.1 - July 3, 2013</h3>

</div>
<div class="sect2">
<h3 id="_version_1_1_july_3_2013">Version 1.1 - July 3, 2013</h3>

</div>
<div class="sect2">
<h3 id="_version_1_0_1_october_28_2012">Version 1.0.1 - October 28, 2012</h3>

</div>
<div class="sect2">
<h3 id="_version_1_0_0_july_4_2012">Version 1.0.0 - July 4, 2012</h3>

</div>
<div class="sect2">
<h3 id="_version_1_0_0_rc1_may_22_2012">Version 1.0.0.RC1 - May 22, 2012</h3>

</div>
<div class="sect2">
<h3 id="_version_1_0_0_m2_may_12_2012">Version 1.0.0.M2 - May 12, 2012</h3>

</div>


<h1 id="usage">2 Usage</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/usage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The cache plugin adds Spring bean method call, GSP page fragment and
template caching to Grails applications. You configure one or more caches
in <code>grails-app/conf/application.yml</code>, and
annotate methods (either in Spring beans (typically Grails services)) to be cached.
You can also wrap GSP sections in cache tags and render cached templates.</p>
</div>
<div class="paragraph">
<p>There are three annotations; <a href="../api/grails/plugin/cache/Cacheable.html">Cacheable</a>,
<a href="../api/grails/plugin/cache/CachePut.html">CachePut</a>,
and <a href="../api/grails/plugin/cache/CacheEvict.html">CacheEvict</a>. You use
<code>Cacheable</code> to mark a method as one that should check the cache for a
pre-existing result, or generate a new result and cache it. Use <code>CachePut</code> to
mark a method as one that should always be evaluated and store its result in the
cache regardless of existing cache values. And use <code>@CacheEvict</code> to flush a cache
(either fully or partially) to force the re-evaluation of previously cached
results.</p>
</div>
<div class="paragraph">
<p>When using distributed caching (such as ehcache with distributed cache enabled,
or redis with multiple instances of the application running against one redis
instance), all classes that use annotation caching or XML caching should
override the <code>hashCode</code> method. The hash code of the object with the method
marked as being cacheable is included in the cache key, and the default
<code>hashCode</code> implementation will vary each time the application is run. Overriding
<code>hashCode</code> ensures that each instance of the applications will appropriately
share cache keys.</p>
</div>
<div class="paragraph">
<p>This 'core' cache plugin uses an in-memory implementation where the caches and
cache manager are backed by a thread-safe <code>java.util.concurrent.ConcurrentMap</code>.
This is fine for testing and possibly for low-traffic sites, but you should
consider using one of the extension plugins if you need clustering, disk
storage, persistence between restarts, and more configurability of features like
time-to-live, maximum cache size, etc. Currently the only extension plugin available for Grails 3 is <a href="https://plugins.grails.org/plugin/grails/cache-ehcache">cache-ehcache</a>.</p>
</div>


<h2 id="dsl">2.1 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/usage/dsl.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_configuration_options">Configuration Options</h3>
<div class="paragraph">
<p>There are a few configuration options for the plugin; these are specified in
<code>grails-app/conf/application.yml</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.cache.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable the plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.cache.clearAtStartup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to clear all caches at startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.cache.cacheManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lGrailsConcurrentMapCacheManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Manager to use. Default cache manager uses Spring Frameworks ConcurrentMapCache which might grow limitless. If you cannot predict how many cache entries you are going to generate use "GrailsConcurrentLinkedMapCacheManager" instead which uses com.googlecode.concurrentlinkedhashmap.ConcurrentLinkedHashMap and limits by default to 10000 entries per cache.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The cache implementation used by this plugin is very simple, so there aren&#8217;t
many configuration options (compared to the Ehcache implementation for example,
where you have fine-grained control over features like overflowing to disk,
time-to-live settings, maximum size of caches, etc.) So there aren&#8217;t many
supported options in the cache configuration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since there is no way to configure "time to live" with this plugin, all
cached items have no timeout and remain cached until either the JVM restarts
(since the backing store is in-memory) or the cache is partially or fully
cleared (by calling a method or action annotated with \@CacheEvict or
programmatically).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t need to supply any configuration to your cache, simply don&#8217;t include it in the configuration.</p>
</div>
<div class="paragraph">
<p>If you want to limit the number of cache entries you have to change the default
cache manager to <code>'GrailsConcurrentLinkedMapCacheManager'</code>. To specify the limit
you can add the <code>maxCapacity</code> parameter to the cache config. Default value for
<code>maxCapacity</code> is 10000.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cache</span>:
        <span class="key">cacheManager</span>: <span class="string"><span class="content">GrailsConcurrentLinkedMapCacheManager</span></span>
        <span class="key">caches</span>:
            <span class="key">message</span>:
                <span class="key">maxCapacity</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">maps</span>:
                <span class="key">maxCapacity</span>: <span class="string"><span class="content">6000</span></span></code></pre>
</div>
</div>
</div>


<h2 id="annotations">2.2 Cache Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/usage/annotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/grails/plugin/cache/Cacheable.html">Cacheable</a> and <a href="../api/grails/plugin/cache/CacheEvict.html">CacheEvict</a> annotations provided by the plugin have counterparts with the same names provided by Spring.</p>
</div>
<div class="paragraph">
<p>However, unlike the Spring versions, these apply AST transformations, avoiding the need to create runtime proxies.</p>
</div>
<div class="sect1">
<h2 id="_service_method_caching">Service Method Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Given the below simple service, you can see that the <code>getMessage</code> method is configured to cache the results in the <code>"message"</code> cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.yourcompany

<span class="keyword">import</span> <span class="include">grails.plugin.cache.*</span>

<span class="type">class</span> <span class="class">MessageService</span> {

   <span class="annotation">@Cacheable</span>(<span class="string"><span class="delimiter">'</span><span class="content">message</span><span class="delimiter">'</span></span>)
   Message getMessage(<span class="predefined-type">String</span> title) {
      println <span class="string"><span class="delimiter">'</span><span class="content">Fetching message</span><span class="delimiter">'</span></span>
      Message.findByTitle(title)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the cache key is calculated using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class name</p>
</li>
<li>
<p>The method name</p>
</li>
<li>
<p>The parameter names and values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the previous example, the <code>title</code> parameter will be used as the cache key; if there were multiple parameters they would be combined into the key.</p>
</div>
<div class="paragraph">
<p>You can use a closure to dynamically define the key. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.yourcompany

<span class="keyword">import</span> <span class="include">grails.plugin.cache.*</span>

<span class="type">class</span> <span class="class">MessageService</span> {

   <span class="annotation">@Cacheable</span>(value = <span class="string"><span class="delimiter">'</span><span class="content">message</span><span class="delimiter">'</span></span>, key = { title.toUpperCase() } )
   Message getMessage(<span class="predefined-type">String</span> title) {
      println <span class="string"><span class="delimiter">'</span><span class="content">Fetching message</span><span class="delimiter">'</span></span>
      Message.findByTitle(title)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CachePut</code> annotation can be used to place a value into the cache. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.yourcompany

<span class="keyword">import</span> <span class="include">grails.plugin.cache.*</span>

<span class="type">class</span> <span class="class">MessageService</span> {

   ...

   <span class="annotation">@CachePut</span>(value=<span class="string"><span class="delimiter">'</span><span class="content">message</span><span class="delimiter">'</span></span>, key = { message.title })
   <span class="type">void</span> save(Message message) {
      println <span class="string"><span class="delimiter">&quot;</span><span class="content">Saving message </span><span class="inline"><span class="inline-delimiter">$</span>message</span><span class="delimiter">&quot;</span></span>
      message.save()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method in the example above is configured as one that evicts elements from the cache. There is no need to clear the entire cache in this case; instead any previously cached item with the same <code>title</code> attribute will be replaced with the current <code>Message</code> instance.</p>
</div>
<div class="paragraph">
<p>Note that you could also use <code>CacheEvict</code> for the <code>save</code> method, which would remove the old cached value but not cache the current value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.yourcompany

<span class="keyword">import</span> <span class="include">grails.plugin.cache.*</span>

<span class="type">class</span> <span class="class">MessageService</span> {

   ...

   <span class="annotation">@CacheEvict</span>(value=<span class="string"><span class="delimiter">'</span><span class="content">message</span><span class="delimiter">'</span></span>, key = { message.title })
   <span class="type">void</span> delete(Message message) {
      println <span class="string"><span class="delimiter">&quot;</span><span class="content">Deleting message </span><span class="inline"><span class="inline-delimiter">$</span>message</span><span class="delimiter">&quot;</span></span>
      message.delete()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This service works with the <code>Message</code> domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.yourcompany

<span class="type">class</span> <span class="class">Message</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1</span>

   <span class="predefined-type">String</span> title
   <span class="predefined-type">String</span> body

   <span class="predefined-type">String</span> toString() {
      <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>title</span><span class="content">: </span><span class="inline"><span class="inline-delimiter">$</span>body</span><span class="delimiter">&quot;</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that for in-memory cache implementations it&#8217;s not required that the objects being cached implement <code>Serializable</code> but if you use an implementation that uses Java serialization (for example the Redis plugin, or the Ehcache plugin when you have configured clustered caching) you must implement <code>Serializable</code>.</p>
</div>
<div class="paragraph">
<p>To test this out, be sure to define a <code>"message"</code> cache in <code>grails-app/conf/application.yml</code> and save and retrieve <code>Message</code> instances using the service. There are <code>println</code> statements but you can also turn on SQL logging to watch the database access that&#8217;s needed to retrieve instances that aren&#8217;t cached yet, and you shouldn&#8217;t see database access for cached values.</p>
</div>
</div>
</div>


<h2 id="unittests">2.2.1 Unit Testing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/usage/unittests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In general, code that is marked with cache related annotations can be unit
tested without doing anything special to deal with caching.  The caching just
won&#8217;t be enabled and the code in cached methods will be executed each time the
method is invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">BasicCachingService</span> {

    <span class="directive">private</span> <span class="type">int</span> invocationCounter = <span class="integer">0</span>
    <span class="directive">private</span> <span class="type">int</span> conditionalInvocationCounter = <span class="integer">0</span>

    <span class="keyword">def</span> <span class="function">getInvocationCounter</span>() {
        invocationCounter
    }

    <span class="annotation">@Cacheable</span>(<span class="string"><span class="delimiter">'</span><span class="content">basic</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> <span class="function">getData</span>() {
        ++invocationCounter
        <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">BasicCachingServiceNoCacheManagerSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;BasicCachingService&gt; {

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test invoking cacheable method when no cache manager is present</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">a cached method is invoked the first time</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> result = service.getData()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the code in the method is executed</span><span class="delimiter">'</span></span>
        result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
        service.invocationCounter == <span class="integer">1</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">a cached method is invoked the second time</span><span class="delimiter">'</span></span>
        result = service.getData()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the code in the method is still executed because no cache manager is present</span><span class="delimiter">'</span></span>
        result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
        service.invocationCounter == <span class="integer">2</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order for caching to be active when the unit test is running, cache manager
and key generator beans must be added to the Spring application context by the
test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

<span class="keyword">import</span> <span class="include">grails.plugin.cache.CustomCacheKeyGenerator</span>
<span class="keyword">import</span> <span class="include">grails.plugin.cache.GrailsConcurrentMapCacheManager</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">BasicCachingServiceSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;BasicCachingService&gt; {

    <span class="annotation">@Override</span>
    Closure doWithSpring() {{ -&gt;
        grailsCacheManager(GrailsConcurrentMapCacheManager)
        customCacheKeyGenerator(CustomCacheKeyGenerator)
    }}

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test invoking cacheable method when cache manager is present</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">a cached method is invoked the first time</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> result = service.getData()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the code in the method is executed</span><span class="delimiter">'</span></span>
        result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
        service.invocationCounter == <span class="integer">1</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">a cached method is invoked the second time</span><span class="delimiter">'</span></span>
        result = service.getData()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the cached return value is returned and the code in the method is not executed</span><span class="delimiter">'</span></span>
        result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
        service.invocationCounter == <span class="integer">1</span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test invoking a cacheable method that expresses a condition</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">multiply is called with x &lt; 10</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> result = service.multiply(<span class="integer">4</span>, <span class="integer">7</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the method should have been invoked</span><span class="delimiter">'</span></span>
        result == <span class="integer">28</span>
        service.conditionalInvocationCounter == <span class="integer">1</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the method is invoked with x &gt; 10</span><span class="delimiter">'</span></span>
        result = service.multiply(<span class="integer">40</span>, <span class="integer">7</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the method should have executed</span><span class="delimiter">'</span></span>
        result == <span class="integer">280</span>
        service.conditionalInvocationCounter == <span class="integer">2</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">multiply is called with x &lt; 10 with a cached value</span><span class="delimiter">'</span></span>
        result = service.multiply(<span class="integer">4</span>, <span class="integer">7</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the method should not have executed</span><span class="delimiter">'</span></span>
        result == <span class="integer">28</span>
        service.conditionalInvocationCounter == <span class="integer">2</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the method is invoked with x &gt; 10 again</span><span class="delimiter">'</span></span>
        result = service.multiply(<span class="integer">40</span>, <span class="integer">7</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the condition should prevent caching</span><span class="delimiter">'</span></span>
        result == <span class="integer">280</span>
        service.conditionalInvocationCounter == <span class="integer">3</span>
    }
}</code></pre>
</div>
</div>


<h2 id="cacheManager">2.3 The CacheManager</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/usage/cacheManager.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The plugin registers an instance of the <a href="https://docs.spring.io/spring/docs/current/javadoc-api//org/springframework/cache/CacheManager.html">CacheManager</a> interface as the <code>grailsCacheManager</code> Spring bean, so it&#8217;s easy to access using dependency injection.</p>
</div>
<div class="paragraph">
<p>The most common method you would call on the <code>grailsCacheManager</code> is <code>getCache(String name)</code> to access a <a href="https://docs.spring.io/spring/docs/current/javadoc-api//org/springframework/cache/Cache.html">Cache</a> instance programmatically. This shouldn&#8217;t be needed often however. From the <code>Cache</code> instance you can also access the underlying cache implementation using <code>cache.getNativeCache()</code>.</p>
</div>


<h1 id="cacheTags">3 Caching Tags</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/cacheTags.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The plugin provides GSP tags which are useful for caching the result of evaluating sections of markup.  These tags allow for the result of evaluating sections of markup to be cached so subsequent renderings of the same markup do not have to result in the markup being evaluated again.  These tags support automatic cache eviction with the use of a time to live (ttl) attribute.</p>
</div>
<div class="paragraph">
<p>See the documentation for the <a href="../ref/Tags/block.html">block</a> and <a href="../ref/Tags/render.html">render</a> tags for more details.</p>
</div>


<h1 id="grailsCacheAdminService">4 The Cache Admin Service</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/grailsCacheAdminService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The plugin provides a service named <a href="../api/grails/plugin/cache/GrailsCacheAdminService.html">GrailsCacheAdminService</a> which support various methods for administering caches.</p>
</div>


<h2 id="clearingCaches">4.1 Clearing Caches</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/grailsCacheAdminService/clearingCaches.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are methods in <a href="../api/grails/plugin/cache/GrailsCacheAdminService.html">GrailsCacheAdminService</a> for clearing the caches used by the <a href="../ref/Tags/block.html">block</a> and <a href="../ref/Tags/render.html">render</a> tags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">ReportingController</span> {

    def grailsCacheAdminService

    def report() {
        <span class="comment">// clear the cache used by the blocks tag...</span>
        grailsCacheAdminService.clearBlocksCache()

        <span class="comment">// clear the cache used by the render tag...</span>
        grailsCacheAdminService.clearTemplatesCache()

        ...
    }
}</code></pre>
</div>
</div>


<h1 id="implementation">5 Implementation Details</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-cache/edit/master/src/main/docs/guide/implementation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All of the plugin&#8217;s classes are designed for extensibility; the classes are all public, and fields and methods are mostly public or protected. Consider subclassing existing classes to reuse as much as possible instead of completely rewriting them.</p>
</div>
<div class="sect1">
<h2 id="_cache_manager">Cache manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core cache plugin registers a <code>grailsCacheManager</code> Spring bean, and the extension plugins replace this bean with one that creates and manages caches for that implementation. The default implementation is an instance of <a href="../api/grails/plugin/cache/GrailsConcurrentMapCacheManager.html">GrailsConcurrentMapCacheManager</a> which uses <a href="../api/grails/plugin/cache/GrailsConcurrentMapCache.html">GrailsConcurrentMapCache</a> as its cache implementation. It uses a <code>java.util.concurrent.ConcurrentHashMap</code> to store cached values.</p>
</div>
<div class="paragraph">
<p>You can customize the cache manager by replacing the <code>grailsCacheManager</code> Spring bean in <code>resources.groovy</code> with your own; either subclass <a href="../api/grails/plugin/cache/GrailsConcurrentMapCacheManager.html">GrailsConcurrentMapCacheManager</a> (e.g. to override the <code>createConcurrentMapCache()</code> method) or by implementing the <a href="../api/org/grails/plugin/cache/GrailsCacheManager.html">GrailsCacheManager</a> interface.</p>
</div>
<div class="sect2">
<h3 id="_fragment_caching">Fragment caching</h3>
<div class="paragraph">
<p>You can cache partial GSP page sections with the <code>&lt;cache:block&gt;</code> tag. You can specify a key when using this tag but it&#8217;s in general unnecessary. This is because the block will be rendered with its own Closure, and the default key is the full closure class name. This is unique since the closures aren&#8217;t re-used; for example these two blocks will be cached independently, even in the same GSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">cache</span>:block&gt;
foo
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">cache:block&gt;</span></span><span class="error">
</span>
&lt;<span class="key">cache</span>:block&gt;
bar
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">cache:block&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can cache the content of templates with the <code>&lt;cache:render&gt;</code> tag. You can specify a key when using this tag but like the <code>block</code> tag, it&#8217;s in general unnecessary because the default key is the full template class name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_caching">Service caching</h3>
<div class="paragraph">
<p>You can cache the return value of a service method by annotating it with <a href="../api/grails/plugin/cache/Cacheable.html">Cacheable</a>.</p>
</div>
<div class="sect3">
<h4 id="_key_generation">Key generation</h4>
<div class="paragraph">
<p>The default key generated implements the <a href="../api/grails/plugin/cache/GrailsCacheKeyGenerator.html">GrailsCacheKeyGenerator</a> which provides method for generating keys taking into account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class name</p>
</li>
<li>
<p>The method name</p>
</li>
<li>
<p>A hashCode for the current object</p>
</li>
<li>
<p>The parameters or if a closure is specified to generate the key the value of the closure call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can override this implementation by defining a bean called <code>customCacheKeyGenerator</code> via Spring.</p>
</div>
</div>
</div>
</div>
</div>

            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags/block.html">block</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/render.html">render</a>
                        </div>
                        
                    </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>


</body>
</html>
